/*
 *   Copyright OpenSearch Contributors
 *
 *   Licensed under the Apache License, Version 2.0 (the "License").
 *   You may not use this file except in compliance with the License.
 *   A copy of the License is located at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 *   or in the "license" file accompanying this file. This file is distributed
 *   on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 *   express or implied. See the License for the specific language governing
 *   permissions and limitations under the License.
 */

import {
  composeNextUrlQueryParam,
  validateNextUrl,
  INVALID_NEXT_URL_PARAMETER_MESSAGE,
} from './next_url';

describe('test composeNextUrlQueryParam', () => {
  test('no base, no path', () => {
    expect(
      composeNextUrlQueryParam(
        {
          url: 'http://localhost:123',
        },
        ''
      )
    ).toEqual('');
  });

  test('no base, path', () => {
    expect(
      composeNextUrlQueryParam(
        {
          url: 'http://localhost:123/alpha/major/foxtrot',
        },
        ''
      )
    ).toEqual('nextUrl=%2Falpha%2Fmajor%2Ffoxtrot');
  });

  test('base, no path', () => {
    expect(
      composeNextUrlQueryParam(
        {
          url: 'http://localhost:123',
        },
        'xyz'
      )
    ).toEqual('');
  });

  test('base, path', () => {
    expect(
      composeNextUrlQueryParam(
        {
          url: 'http://localhost:123/alpha/major/foxtrot',
        },
        'xyz'
      )
    ).toEqual('nextUrl=xyz%2Falpha%2Fmajor%2Ffoxtrot');
  });
});

/* eslint-disable no-script-url */
describe('test validateNextUrl', () => {
  test('accept relative url', () => {
    const url = '/relative/path';
    expect(validateNextUrl(url)).toEqual(undefined);
  });

  test('accept relative url with # and query', () => {
    const url = '/relative/path#hash?a=b';
    expect(validateNextUrl(url)).toEqual(undefined);
  });

  test('reject url not start with /', () => {
    const url = 'exmaple.com/relative/path';
    expect(validateNextUrl(url)).toEqual(INVALID_NEXT_URL_PARAMETER_MESSAGE);
  });

  test('reject absolute url', () => {
    const url = 'https://exmaple.com/relative/path';
    expect(validateNextUrl(url)).toEqual(INVALID_NEXT_URL_PARAMETER_MESSAGE);
  });

  test('reject url starts with //', () => {
    const url = '//exmaple.com/relative/path';
    expect(validateNextUrl(url)).toEqual(INVALID_NEXT_URL_PARAMETER_MESSAGE);
  });

  test('accpet url has @ in query parameters', () => {
    const url = '/test/path?key=a@b&k2=v';
    expect(validateNextUrl(url)).toEqual(undefined);
  });

  test('allow slash', () => {
    const url = '/';
    expect(validateNextUrl(url)).toEqual(undefined);
  });

  test('allow dashboard url', () => {
    const url =
      '/_plugin/opensearch-dashboards/app/opensearch-dashboards#dashbard/dashboard-id?_g=(param=a&p=b)';
    expect(validateNextUrl(url)).toEqual(undefined);
  });

  // test cases from https://pentester.land/cheatsheets/2018/11/02/open-redirect-cheatsheet.html
  test('test list', () => {
    const urlList = [
      '<>//â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '//;@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '/////â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      '/////â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '////â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦//',
      '////â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      '///;@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '///â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦//',
      '///â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      '///â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '///â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      '//â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦//',
      '//â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      '//â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '/.â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '//â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      '/ã€±â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '.â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '//â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      'ã€±â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '//â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒ%00ï½¡ï¼°â“¦',
      '%01https://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '%01https://google.com',
      '////%09/â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '///%09/â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '//%09/â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '/%09/â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '////%09/google.com',
      '///%09/google.com',
      '//%09/google.com',
      '/%09/google.com',
      '/%09/javascript:alert(1);',
      '/%09/javascript:alert(1)',
      '////%09/whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '///%09/whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '//%09/whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '/%09/whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '////%09/whitelisted.com@google.com',
      '///%09/whitelisted.com@google.com',
      '//%09/whitelisted.com@google.com',
      '/%09/whitelisted.com@google.com',
      '&%0d%0a1Location:https://google.com',
      '\\152\\141\\166\\141\\163\\143\\162\\151\\160\\164\\072alert(1)',
      '%19Jav%09asc%09ript:https%20://whitelisted.com/%250Aconfirm%25281%2529',
      '////216.58.214.206',
      '///216.58.214.206',
      '//216.58.214.206',
      '/\\216.58.214.206',
      '/216.58.214.206',
      '216.58.214.206',
      '////â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e',
      '///â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e',
      '////â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e%2f',
      '///â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e%2f',
      '//â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e%2f',
      '////â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f..',
      '///â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f..',
      '//â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f..',
      '%2f216.58.214.206//',
      '%2f216.58.214.206',
      '%2f216.58.214.206%2f%2f',
      '////â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f%2e%2e',
      '///â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f%2e%2e',
      '//â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f%2e%2e',
      '/â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f%2e%2e',
      '//%2f%2fâ“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '/%2f%2fâ“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '%2f$2f216.58.214.206',
      '$2f%2f216.58.214.206%2f%2f',
      '%2f$2f3627734734',
      '$2f%2f3627734734%2f%2f',
      '//%2f%2fgoogle.com',
      '/%2f%2fgoogle.com',
      '$2f%2fgoogle.com',
      '%2f$2fgoogle.com',
      '$2f%2fgoogle.com%2f%2f',
      '%2f3627734734//',
      '%2f3627734734',
      '%2f3627734734%2f%2f',
      '/%2f%5c%2f%67%6f%6f%67%6c%65%2e%63%6f%6d/',
      '/%2f%5c%2f%6c%6f%63%61%6c%64%6f%6d%61%69%6e%2e%70%77/',
      '%2fgoogle.com//',
      '%2fgoogle.com',
      '%2fgoogle.com%2f%2f',
      '////3627734734',
      '///3627734734',
      '//3627734734',
      '/\\3627734734',
      '/3627734734',
      '3627734734',
      '//3H6k7lIAiqjfNeN@whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      '//3H6k7lIAiqjfNeN@whitelisted.com+@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      '//3H6k7lIAiqjfNeN@whitelisted.com@google.com/',
      '//3H6k7lIAiqjfNeN@whitelisted.com+@google.com/',
      '////%5câ“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '///%5câ“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '//%5câ“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '/%5câ“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '////%5cgoogle.com',
      '///%5cgoogle.com',
      '//%5cgoogle.com',
      '/%5cgoogle.com',
      '//%5cjavascript:alert(1);',
      '//%5cjavascript:alert(1)',
      '/%5cjavascript:alert(1);',
      '/%5cjavascript:alert(1)',
      '////%5cwhitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '///%5cwhitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '//%5cwhitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '/%5cwhitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '////%5cwhitelisted.com@google.com',
      '///%5cwhitelisted.com@google.com',
      '//%5cwhitelisted.com@google.com',
      '/%5cwhitelisted.com@google.com',
      '/%68%74%74%70%3a%2f%2f%67%6f%6f%67%6c%65%2e%63%6f%6d',
      '%68%74%74%70%3a%2f%2f%67%6f%6f%67%6c%65%2e%63%6f%6d',
      '%68%74%74%70%73%3a%2f%2f%6c%6f%63%61%6c%64%6f%6d%61%69%6e%2e%70%77',
      '//â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦:80?@whitelisted.com/',
      '//â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦:80#@whitelisted.com/',
      '";alert(0);//',
      'data:text/html;base64,PHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4=',
      'data:text/html;base64,PHNjcmlwdD5hbGVydCgiWFNTIik7PC9zY3JpcHQ+Cg==',
      'data:text/html;base64,PHNjcmlwdD5hbGVydCgiWFNTIik8L3NjcmlwdD4=',
      'data:whitelisted.com;text/html;charset=UTF-8,<html><script>document.write(document.domain);</script><iframe/src=xxxxx>aaaa</iframe></html>',
      '//â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒ%E3%80%82pw',
      '//google%00.com',
      '/google%252ecom',
      'google%252ecom',
      '<>//google.com',
      '/<>//google.com',
      '//;@google.com',
      '///;@google.com',
      '/////google.com/',
      '/////google.com',
      '////;@google.com',
      '////google.com//',
      '////google.com/',
      '////google.com',
      '///;@google.com',
      '///google.com//',
      '///google.com/',
      '///google.com',
      '///google.com/',
      '//google.com',
      '//google.com//',
      '//google.com/',
      '//google.com',
      '/.google.com',
      '///google.com/',
      '//google.com/',
      '//google.com',
      '/google.com',
      '/ã€±google.com',
      '/google.com',
      '../google.com',
      '.google.com',
      '@google.com',
      '//google.com/',
      'ã€±google.com',
      'google.com',
      'google.com%23@whitelisted.com',
      '////google.com/%2e%2e',
      '///google.com/%2e%2e',
      '//google.com/%2e%2e',
      '/google.com/%2e%2e',
      '//google.com/%2E%2E',
      '////google.com/%2e%2e%2f',
      '///google.com/%2e%2e%2f',
      '//google.com/%2e%2e%2f',
      '////google.com/%2f..',
      '///google.com/%2f..',
      '//google.com/%2f..',
      '//google.com/%2F.. ',
      '/google.com/%2F.. ',
      '////google.com/%2f%2e%2e',
      '///google.com/%2f%2e%2e',
      '//google.com/%2f%2e%2e',
      '/google.com/%2f%2e%2e',
      '//google.com//%2F%2E%2E',
      '//google.com:80?@whitelisted.com/',
      '//google.com:80#@whitelisted.com/',
      'google.com/.jpg',
      '//google.com\\twhitelisted.com/',
      '//google.com/whitelisted.com',
      '//google.com@whitelisted.com',
      'google.com/whitelisted.com',
      '//google%E3%80%82com',
      '/http://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '/http:/â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      'http://;@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      'http://.â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      'http:/â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      'http:â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      'http://00330.00072.0000326.00000316',
      'http:00330.00072.0000326.00000316',
      'http://00330.0x3a.54990',
      'http:00330.0x3a.54990',
      'http://00330.3856078',
      'http:00330.3856078',
      'http://0330.072.0326.0316',
      'http:0330.072.0326.0316',
      'http:%0a%0dâ“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      'http:%0a%0dgoogle.com',
      'http://0xd8.072.54990',
      'http:0xd8.072.54990',
      'http://0xd8.0x3a.0xd6.0xce',
      'http:0xd8.0x3a.0xd6.0xce',
      'http://0xd8.3856078',
      'http:0xd8.3856078',
      'http://0xd83ad6ce',
      'http:0xd83ad6ce',
      'http://[::216.58.214.206]',
      'http:[::216.58.214.206]',
      'http://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦%23.whitelisted.com/',
      'http://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦%2f%2f.whitelisted.com/',
      'http://3627734734',
      'http:3627734734',
      'http://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦%3F.whitelisted.com/',
      'http://3H6k7lIAiqjfNeN@00330.00072.0000326.00000316',
      'http:3H6k7lIAiqjfNeN@00330.00072.0000326.00000316',
      'http://3H6k7lIAiqjfNeN@00330.0x3a.54990',
      'http:3H6k7lIAiqjfNeN@00330.0x3a.54990',
      'http://3H6k7lIAiqjfNeN@00330.3856078',
      'http:3H6k7lIAiqjfNeN@00330.3856078',
      'http://3H6k7lIAiqjfNeN@0330.072.0326.0316',
      'http:3H6k7lIAiqjfNeN@0330.072.0326.0316',
      'http://3H6k7lIAiqjfNeN@0xd8.072.54990',
      'http:3H6k7lIAiqjfNeN@0xd8.072.54990',
      'http://3H6k7lIAiqjfNeN@0xd8.0x3a.0xd6.0xce',
      'http:3H6k7lIAiqjfNeN@0xd8.0x3a.0xd6.0xce',
      'http://3H6k7lIAiqjfNeN@0xd8.3856078',
      'http:3H6k7lIAiqjfNeN@0xd8.3856078',
      'http://3H6k7lIAiqjfNeN@0xd83ad6ce',
      'http:3H6k7lIAiqjfNeN@0xd83ad6ce',
      'http://3H6k7lIAiqjfNeN@[::216.58.214.206]',
      'http:3H6k7lIAiqjfNeN@[::216.58.214.206]',
      'http://3H6k7lIAiqjfNeN@3627734734',
      'http:3H6k7lIAiqjfNeN@3627734734',
      'http://3H6k7lIAiqjfNeN@472.314.470.462',
      'http:3H6k7lIAiqjfNeN@472.314.470.462',
      'http://3H6k7lIAiqjfNeN@[::ffff:216.58.214.206]',
      'http:3H6k7lIAiqjfNeN@[::ffff:216.58.214.206]',
      'http://3H6k7lIAiqjfNeN@whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      'http://3H6k7lIAiqjfNeN@whitelisted.com+@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      'http://3H6k7lIAiqjfNeN@whitelisted.com@google.com/',
      'http://3H6k7lIAiqjfNeN@whitelisted.com+@google.com/',
      'http://472.314.470.462',
      'http:472.314.470.462',
      'http://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦%5c%5c.whitelisted.com/',
      '/http://%67%6f%6f%67%6c%65%2e%63%6f%6d',
      'http://%67%6f%6f%67%6c%65%2e%63%6f%6d',
      'http://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦:80?@whitelisted.com/',
      'http://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦:80#@whitelisted.com/',
      'http://[::ffff:216.58.214.206]',
      'http:[::ffff:216.58.214.206]',
      '/http://google.com',
      '/http:/google.com',
      'http://;@google.com',
      'http://.google.com',
      'http://google.com',
      'http://google.com',
      'http:/google.com',
      'http:google.com',
      'http://google.com%23.whitelisted.com/',
      'http://google.com%2f%2f.whitelisted.com/',
      'http://google.com%3F.whitelisted.com/',
      'http://google.com%5c%5c.whitelisted.com/',
      'http://google.com:80?@whitelisted.com/',
      'http://google.com:80#@whitelisted.com/',
      'http://google.com\\twhitelisted.com/',
      '//https://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦//',
      '/https://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      'https://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦//',
      'https://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      'https://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      'https:â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      'https://%09/â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '/https://%09/google.com',
      'https://%09/google.com',
      'https://%09/whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      'https://%09/whitelisted.com@google.com',
      'https://%0a%0dâ“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      'https://%0a%0dgoogle.com',
      '//https:///â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e',
      '/https://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e',
      'https:///â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e',
      '//https://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e%2f',
      'https://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e%2f',
      '/https://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f..',
      'https://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f..',
      '/https:///â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f%2e%2e',
      '/https://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f%2e%2e',
      'https:///â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f%2e%2e',
      'https://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f%2e%2e',
      'https%3a%2f%2fgoogle.com%2f',
      '/https://%5câ“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '/https:/%5câ“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      'https://%5câ“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      'https:/%5câ“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      '/https://%5cgoogle.com',
      '/https:/%5cgoogle.com/',
      'https://%5cgoogle.com',
      'https:/%5cgoogle.com/',
      '/https://%5cwhitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      'https://%5cwhitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '/https://%5cwhitelisted.com@google.com',
      'https://%5cwhitelisted.com@google.com',
      'https://%6c%6f%63%61%6c%64%6f%6d%61%69%6e%2e%70%77',
      '//https://google.com//',
      '/https://google.com//',
      '/https://google.com/',
      '/https://google.com',
      '/https:google.com',
      'https://////google.com',
      'https://google.com//',
      'https://google.com/',
      'https://google.com',
      'https:/google.com',
      'https:google.com',
      '//https:///google.com/%2e%2e',
      '/https://google.com/%2e%2e',
      'https:///google.com/%2e%2e',
      '//https://google.com/%2e%2e%2f',
      'https://google.com/%2e%2e%2f',
      '/https://google.com/%2f..',
      'https://google.com/%2f..',
      '/https:///google.com/%2f%2e%2e',
      '/https://google.com/%2f%2e%2e',
      'https:///google.com/%2f%2e%2e',
      'https://google.com/%2f%2e%2e',
      'https://:@google.com@whitelisted.com',
      'https://google.com?whitelisted.com',
      'https://google.com/whitelisted.com',
      'https://google.comwhitelisted.com',
      'https://google.com#whitelisted.com',
      'https://google%E3%80%82com',
      '//https://whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦//',
      '/https://whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      'https://:@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦@whitelisted.com',
      'https://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/whitelisted.com',
      'https://whitelisted.com;@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      'https://whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦//',
      'https://whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      'https://whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '/https://whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e',
      'https:///whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e',
      '//https://whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e%2f',
      'https://whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e%2f',
      '/https://whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f..',
      'https://whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f..',
      '/https:///whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f%2e%2e',
      '/https://whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f%2e%2e',
      'https:///whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f%2e%2e',
      'https://whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f%2e%2e',
      '//https://whitelisted.com@google.com//',
      '/https://whitelisted.com@google.com/',
      'https://whitelisted.com;@google.com',
      'https://whitelisted.com.google.com',
      'https://whitelisted.com@google.com//',
      'https://whitelisted.com@google.com/',
      'https://whitelisted.com@google.com',
      '/https://whitelisted.com@google.com/%2e%2e',
      'https:///whitelisted.com@google.com/%2e%2e',
      '//https://whitelisted.com@google.com/%2e%2e%2f',
      'https://whitelisted.com@google.com/%2e%2e%2f',
      '/https://whitelisted.com@google.com/%2f..',
      'https://whitelisted.com@google.com/%2f..',
      '/https:///whitelisted.com@google.com/%2f%2e%2e',
      '/https://whitelisted.com@google.com/%2f%2e%2e',
      'https:///whitelisted.com@google.com/%2f%2e%2e',
      'https://whitelisted.com@google.com/%2f%2e%2e',
      '/https://whitelisted.com@google.com/%2f.//whitelisted.com@google.com/%2f..',
      'https://whitelisted.com/https://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      'https://whitelisted.com/https://google.com/',
      '@https://www.google.com',
      'http://â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦\\twhitelisted.com/',
      'http://whitelisted.com@00330.00072.0000326.00000316',
      'http:whitelisted.com@00330.00072.0000326.00000316',
      'http://whitelisted.com@00330.0x3a.54990',
      'http:whitelisted.com@00330.0x3a.54990',
      'http://whitelisted.com@00330.3856078',
      'http:whitelisted.com@00330.3856078',
      'http://whitelisted.com@0330.072.0326.0316',
      'http:whitelisted.com@0330.072.0326.0316',
      'http://whitelisted.com@0xd8.072.54990',
      'http:whitelisted.com@0xd8.072.54990',
      'http://whitelisted.com@0xd8.0x3a.0xd6.0xce',
      'http:whitelisted.com@0xd8.0x3a.0xd6.0xce',
      'http://whitelisted.com@0xd8.3856078',
      'http:whitelisted.com@0xd8.3856078',
      'http://whitelisted.com@0xd83ad6ce',
      'http:whitelisted.com@0xd83ad6ce',
      'http://whitelisted.com@[::216.58.214.206]',
      'http:whitelisted.com@[::216.58.214.206]',
      'http://whitelisted.com%2eâ“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      'http://whitelisted.com%2egoogle.com/',
      'http://whitelisted.com@3627734734',
      'http:whitelisted.com@3627734734',
      'http://whitelisted.com@472.314.470.462',
      'http:whitelisted.com@472.314.470.462',
      'http://whitelisted.com:80%40â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      'http://whitelisted.com:80%40google.com/',
      'http://whitelisted.com@[::ffff:216.58.214.206]',
      'http:whitelisted.com@[::ffff:216.58.214.206]',
      'http://whitelisted.com@google.com/',
      'http://whitelisted.com+&@google.com#+@whitelisted.com/',
      'http://whitelisted.com+&@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦#+@whitelisted.com/',
      'http://www.google.com.whitelisted.com',
      'http://www.â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦.whitelisted.com',
      'http://XY>.7d8T\\205pZM@00330.00072.0000326.00000316',
      'http:XY>.7d8T\\205pZM@00330.00072.0000326.00000316',
      'http://XY>.7d8T\\205pZM@00330.0x3a.54990',
      'http:XY>.7d8T\\205pZM@00330.0x3a.54990',
      'http://XY>.7d8T\\205pZM@00330.3856078',
      'http:XY>.7d8T\\205pZM@00330.3856078',
      'http://XY>.7d8T\\205pZM@0330.072.0326.0316',
      'http:XY>.7d8T\\205pZM@0330.072.0326.0316',
      'http://XY>.7d8T\\205pZM@0xd8.072.54990',
      'http:XY>.7d8T\\205pZM@0xd8.072.54990',
      'http://XY>.7d8T\\205pZM@0xd8.0x3a.0xd6.0xce',
      'http:XY>.7d8T\\205pZM@0xd8.0x3a.0xd6.0xce',
      'http://XY>.7d8T\\205pZM@0xd8.3856078',
      'http:XY>.7d8T\\205pZM@0xd8.3856078',
      'http://XY>.7d8T\\205pZM@0xd83ad6ce',
      'http:XY>.7d8T\\205pZM@0xd83ad6ce',
      'http://XY>.7d8T\\205pZM@[::216.58.214.206]',
      'http:XY>.7d8T\\205pZM@[::216.58.214.206]',
      'http://XY>.7d8T\\205pZM@3627734734',
      'http:XY>.7d8T\\205pZM@3627734734',
      'http://XY>.7d8T\\205pZM@472.314.470.462',
      'http:XY>.7d8T\\205pZM@472.314.470.462',
      'http://XY>.7d8T\\205pZM@[::ffff:216.58.214.206]',
      'http:XY>.7d8T\\205pZM@[::ffff:216.58.214.206]',
      'http://XY>.7d8T\\205pZM@whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      'http://XY>.7d8T\\205pZM@whitelisted.com+@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      'http://XY>.7d8T\\205pZM@whitelisted.com@google.com/',
      'http://XY>.7d8T\\205pZM@whitelisted.com+@google.com/',
      'ja\\nva\\tscript\\r:alert(1)',
      'java%09script:alert(1)',
      'java%0ascript:alert(1)',
      'java%0d%0ascript%0d%0a:alert(0)',
      'java%0dscript:alert(1)',
      'Javas%26%2399;ript:alert(1)',
      'javascript://%0aalert(1)',
      '<>javascript:alert(1);',
      '//javascript:alert(1);',
      '//javascript:alert(1)',
      '/javascript:alert(1);',
      '/javascript:alert(1)',
      'javascript:alert(1)',
      'javascript:alert(1);',
      'javascript:alert(1)',
      'javascripT://anything%0D%0A%0D%0Awindow.alert(document.cookie)',
      'javascript:confirm(1)',
      'javascript://https://whitelisted.com/?z=%0Aalert(1)',
      'javascript:prompt(1)',
      'jaVAscript://whitelisted.com//%0d%0aalert(1);//',
      'javascript://whitelisted.com?%a0alert%281%29',
      '//â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦\\twhitelisted.com/',
      '\\u006A\\u0061\\u0076\\u0061\\u0073\\u0063\\u0072\\u0069\\u0070\\u0074\\u003aalert(1)',
      '////whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦//',
      '////whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      '///whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦//',
      '///whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      '//â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/whitelisted.com',
      '//â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦@whitelisted.com',
      '//whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦//',
      '//whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      'â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/whitelisted.com',
      'whitelisted.com;@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦',
      '////whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e',
      '///whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e',
      '////whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e%2f',
      '///whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e%2f',
      '//whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e%2f',
      '////whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f..',
      '///whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f..',
      '//whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f..',
      '////whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f%2e%2e',
      '///whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f%2e%2e',
      '//whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2f%2e%2e',
      '/whitelisted.com:80%40google.com',
      'whitelisted.com@%E2%80%AE@google.com',
      '////whitelisted.com@google.com//',
      '////whitelisted.com@google.com/',
      '///whitelisted.com@google.com//',
      '///whitelisted.com@google.com/',
      '//whitelisted.com@google.com//',
      '//whitelisted.com@google.com/',
      'whitelisted.com;@google.com',
      'whitelisted.com.google.com',
      '////whitelisted.com@google.com/%2e%2e',
      '///whitelisted.com@google.com/%2e%2e',
      '////whitelisted.com@google.com/%2e%2e%2f',
      '///whitelisted.com@google.com/%2e%2e%2f',
      '//whitelisted.com@google.com/%2e%2e%2f',
      '////whitelisted.com@google.com/%2f..',
      '///whitelisted.com@google.com/%2f..',
      '//whitelisted.com@google.com/%2f..',
      '////whitelisted.com@google.com/%2f%2e%2e',
      '///whitelisted.com@google.com/%2f%2e%2e',
      '//whitelisted.com@google.com/%2f%2e%2e',
      '//whitelisted.com+&@google.com#+@whitelisted.com/',
      '//whitelisted.com@https:///â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/%2e%2e',
      '//whitelisted.com@https:///google.com/%2e%2e',
      '//whitelisted.com+&@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦#+@whitelisted.com/',
      '/x:1/:///%01javascript:alert(document.cookie)/',
      '\\x6A\\x61\\x76\\x61\\x73\\x63\\x72\\x69\\x70\\x74\\x3aalert(1)',
      '//XY>.7d8T\\205pZM@whitelisted.com@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      '//XY>.7d8T\\205pZM@whitelisted.com+@â“ğ¨ğ—°ï¿½ğ•â…†ğ“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/',
      '//XY>.7d8T\\205pZM@whitelisted.com@google.com/',
      '//XY>.7d8T\\205pZM@whitelisted.com+@google.com/',
    ];
    for (const url in urlList) {
      if (url) {
        expect(validateNextUrl(url)).toEqual(INVALID_NEXT_URL_PARAMETER_MESSAGE);
      }
    }
  });
});
